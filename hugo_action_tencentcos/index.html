<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Github自动构建Hugo, 并同步到腾讯COS, 同时刷新CDN缓存 - 空白Koobai</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><link rel=manifest href=/suju/ios.json><link rel=icon href=https://img.koobai.com/koobai.png><link href=/index.xml title=空白Koobai type=application/rss+xml><link rel=canonical href=https://koobai.com/hugo_action_tencentcos/><link rel=stylesheet href=/css/style.min.4d38ba7bf970c4b49c7c680e6a20efa2b2e787c60acd3f0b5da9048e800302be.css><meta name=description content="把二级域名改成一级，过程中发现Cloudflare Pages如果要绑定一级，须把域名的DNS服务器解析过去。解析之后，自己的nas访问变得不稳定，时不时的打不开，来来回回折腾了好几次，无解，只好改回去。 vercel可以绑定一级，尝试之后，访问速度太慢，放弃。开始了解国内的云服务，学习到了对象储存、CDN，经过一番对比尝试，最终选择腾讯云的COS对象存储配合内容分发网络CDN搭建。 "><meta property="og:title" content="Github自动构建Hugo, 并同步到腾讯COS, 同时刷新CDN缓存"><meta property="og:type" content="website"><meta property="og:url" content="https://koobai.com/hugo_action_tencentcos/"><meta property="og:image" content="https://img.koobai.com/article/cdn.svg"><meta property="og:description" content="把二级域名改成一级，过程中发现Cloudflare Pages如果要绑定一级，须把域名的DNS服务器解析过去。解析之后，自己的nas访问变得不稳定，时不时的打不开，来来回回折腾了好几次，无解，只好改回去。 vercel可以绑定一级，尝试之后，访问速度太慢，放弃。开始了解国内的云服务，学习到了对象储存、CDN，经过一番对比尝试，最终选择腾讯云的COS对象存储配合内容分发网络CDN搭建。 "></head><body class='page page-blog-single'><div id=menu-main-mobile class=menu-main-mobile><ul class=menu><li><a href=https://koobai.com/>唠叨</a></li><li><a href=https://koobai.com/posts/>博文</a></li><li><a href=https://koobai.com/movies/>观影</a></li><li><a href=https://koobai.com/apps/>软件</a></li><li><a href=https://koobai.com/hardware/>喜爱</a></li><li><a href=https://qiszy.taobao.com>店铺</a></li></ul></div><div id=wrapper class=wrapper><div class=header><div id=toggle-menu-main-mobile class=hamburger-trigger><button class=hamburger>Menu</button></div><div class=new-heard-menu><div class=header-menu><a href=/ data-umami-event=Home><span class=menu-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bird"><path d="M16 7h.01"/><path d="M3.4 18H12a8 8 0 008-8V7a4 4 0 00-7.28-2.3L2 20"/><path d="m20 7 2 .5-2 .5"/><path d="M10 18v3"/><path d="M14 17.75V21"/><path d="M7 18a6 6 0 003.84-10.61"/></svg>
</span><span class=menu-name>唠叨</span></a></div><div class=header-menu><a href=/posts/ data-umami-event=Bowen><span class=menu-icon><svg width="20" height="20" viewBox="0 0 26 26"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32 1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></svg>
</span><span class=menu-name>博文</span></a></div><div class=header-menu><a href=/movies/ data-umami-event=Movies><span class=menu-icon><svg width="20" height="20" viewBox="0 -1 27 27"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M18 8a2 2 0 000-4 2 2 0 00-4 0 2 2 0 00-4 0A2 2 0 006 4a2 2 0 000 4m4 14L9 8m5 14 1-14"/><path d="M20 8c.5.0.9.4.8 1l-2.6 12c-.1.5-.7 1-1.2 1H7c-.6.0-1.1-.4-1.2-1L3.2 9c-.1-.6.3-1 .8-1z"/></g></svg>
</span><span class=menu-name>观影</span></a></div><div class=header-menu><a href=/apps/ data-umami-event=Apps><span class=menu-icon><svg width="20" height="20" viewBox="30 38 206 206"><g fill="none"><path fill="#00A0E2" fill-rule="evenodd" d="M191.072 195.009c-3.27 5.387-6.54 9.426-10.484 13.176-4.424 3.944-5.674 7.406-15.87 8.754-7.213 1.347-13.465-1.348-15.87-2.405-7.214-3.367-10.966-4.424-15.293-4.424-4.232.0-7.791 1.058-14.909 4.328-2.212 1.153-8.175 3.751-15.485 2.405-7.502-1.347-11.35-4.232-14.139-6.637-5.771-5.097-10.1-9.907-14.043-15.485z" clip-rule="evenodd"/><path fill="#34BE2D" fill-rule="evenodd" d="M58.726 105.27c3.366-7.598 7.79-12.696 12.215-16.255 11.253-9.233 29.624-9.81 38.088-7.598 6.926 1.731 11.831 5.963 19.622 5.963 8.175.0 12.887-4.136 19.333-5.963 8.464-2.116 26.931-1.443 38.954 7.79 3.559 2.694 6.827 6.349 8.655 8.369-4.327 3.174-6.925 5.482-9.041 7.694z" clip-rule="evenodd"/><path fill="#FFB400" fill-rule="evenodd" d="M186.553 105.27c-2.02 2.212-3.462 4.329-5.098 7.31-1.922 3.463-4.232 8.176-4.809 15.293H53.051c.096-1.154.192-2.404.384-3.655 1.155-7.598 2.982-13.85 5.29-18.948z" clip-rule="evenodd"/><path fill="#FF7A00" fill-rule="evenodd" d="M176.646 127.873a74 74 0 000 6.541c.289 5.29 2.116 11.157 4.521 15.87l-125.712-.289c-1.731-7.598-2.693-15.389-2.404-22.122z" clip-rule="evenodd"/><path fill="#F41E34" fill-rule="evenodd" d="M181.166 150.284a33 33 0 003.558 5.771c8.272 10.58 11.831 10.58 18.275 13.851-.479 1.152-.864 2.212-1.346 3.174l-138.888-.289c-2.693-5.867-5.482-14.139-7.31-22.795z" clip-rule="evenodd"/><path fill="#A2359C" fill-rule="evenodd" d="M201.653 173.08c-4.039 9.426-7.31 16.349-10.581 21.929l-116.091-.288c-3.848-5.675-7.31-11.928-11.254-19.719-.288-.673-.673-1.443-.962-2.211z" clip-rule="evenodd"/><path fill="#34BE2D" fill-rule="evenodd" d="M161.352 52.658c-.674 4.81-3.078 10.965-6.925 14.908-4.138 4.425-10.581 9.234-14.429 11.639-2.116 1.346-7.599 1.538-12.118 2.02-.577-4.04-.673-7.503.577-11.254 1.635-4.424 3.753-10.772 7.118-15.197 4.135-5.482 8.848-9.233 11.445-10.58 3.464-1.731 9.235-4.328 14.236-5.194.193 4.424.867 9.426.096 13.658" clip-rule="evenodd"/></g></svg>
</span><span class=menu-name>软件</span></a></div><div class=header-menu><a href=/hardware/ data-umami-event=Good><span class=menu-icon><svg width="20" height="20" viewBox="0 0 25 25"><g fill="none"><path fill="currentColor" d="m15 10-.986-.164A1 1 0 0015 11zM4 10V9a1 1 0 00-1 1zm16.522 2.392.98.196zM6 21h11.36v-2H6zM18.56 9H15v2h3.56zm-2.573 1.164.805-4.835L14.82 5l-.806 4.836zM14.82 3h-.214v2h.214zm-3.543 1.781L8.763 8.555l1.664 1.11 2.516-3.774zM7.93 9H4v2h3.93zM3 10v8h2v-8zm17.302 8.588 1.2-6-1.96-.392-1.2 6zM8.762 8.555A1 1 0 017.93 9v2a3 3 0 002.496-1.336zm8.03-3.226A2 2 0 0014.82 3v2zM18.56 11a1 1 0 01.981 1.196l1.961.392A3 3 0 0018.561 9zm-1.2 10a3 3 0 002.942-2.412l-1.96-.392A1 1 0 0117.36 19zM14.606 3a4 4 0 00-3.328 1.781l1.664 1.11A2 2 0 0114.606 5zM6 19a1 1 0 01-1-1H3a3 3 0 003 3z"/><path stroke="currentColor" stroke-width="1.2" d="M8 10v10"/></g></svg>
</span><span class=menu-name>喜爱</span></a></div><div class=header-menu><a href=https://qiszy.taobao.com target=_blank data-umami-event=Taobao><span class=menu-icon><svg width="20" height="20" viewBox="1 0 24 24"><path fill="currentColor" d="M17.173 14H14.5v1.375q.824-.332 1.812-.81l-.082-.238zm.828-.287.12-.042c.641 1.851 1.034 3.012 1.185 3.5l-1.912.59q-.11-.36-.427-1.293c-6.081 2.884-8.671 2.054-9.008-1.908l1.993-.169c.1 1.165.344 1.621.897 1.752.393.093.94.063 1.652-.104v-2.04h-3.5v-2h.513l-1.167-1.39q1.563-1.312 2.449-2.863-.78.202-1.552.435A14 14 0 017.49 10.29l-1.4-1.428Q8 6.992 9.266 3.868l1.854.75q-.23.567-.48 1.1c3.702-.935 7.275-1.316 9.138-.68 1.223.419 1.919 1.392 2.188 2.585.17.756.313 2.689.313 5.123.0 2.807-.056 3.77-.34 4.622-.298.89-.697 1.418-1.408 1.984-.657.523-1.553.763-2.645.823a12.5 12.5.0 01-2.094-.08c-.12-.013-.235-.027-.355-.042l-.242-.033.264-1.982.237.032.319.038c.625.07 1.216.1 1.762.07.714-.04 1.245-.181 1.508-.39.426-.34.591-.558.756-1.054.186-.555.238-1.448.238-3.989.0-2.298-.134-4.101-.265-4.682-.13-.577-.41-.97-.883-1.132-1.207-.412-3.801-.194-6.652.416l.615.263q-.195.453-.43.89h5.337v2h-3.5V12h3.5zm-5.5-3.213h-1.208A14 14 0 019.799 12h2.702zm-10.038-.438L3.54 8.376c1.062.68 2.935 2.428 3.338 3.162 1.239 2.26.198 4.176-3.122 7.997l-1.51-1.311c2.687-3.094 3.5-4.59 2.878-5.725-.214-.39-1.857-1.923-2.661-2.437M5.14 7.583c-1.048.0-1.882-.762-1.886-1.693.0-.94.838-1.701 1.886-1.701 1.04.0 1.883.758 1.883 1.701.0.935-.843 1.693-1.883 1.693"/></svg>
</span><span class=menu-name>店铺</span></a></div></div><div class=index-laodao><div class=index-laodao-titile></div></div><div class=heard-right><div class="about-koobai avatar-mobile"><a href=/about><img src=https://img.koobai.com/koobai.webp alt=koobai title=空白Koobai data-umami-event=Me></a></div><a href=https://github.com/koobai/blog title=Github target=_blank class=githuab data-umami-event=Github><svg aria-hidden="true" viewBox="0 0 16 16" data-view-component="true"><path d="M8 0c4.42.0 8 3.58 8 8a8.013 8.013.0 01-5.45 7.59c-.4.08-.55-.17-.55-.38.0-.27.01-1.13.01-2.2.0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95.0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12.0.0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27s-1.36.09-2 .27c-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15.0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94.0.67.01 1.3.01 1.49.0.21-.15.45-.55.38A7.995 7.995.0 010 8c0-4.42 3.58-8 8-8z"/></svg></a><div data-umami-event=Rss class=header-Rss><svg viewBox="0 1 23 23" fill="currentColor"><path d="M3 3c9.9411.0 18 8.0589 18 18H18C18 12.7157 11.2843 6 3 6V3zm0 7c6.07513.0 11 4.9249 11 11H11c0-4.4183-3.58172-8-8-8V10zm0 7c2.20914.0 4 1.7909 4 4H3V17z"/></svg><div class=rss-box><div class=footer-rss><a href=https://memos.koobai.com/u/1/rss.xml target=_blank>唠叨 RSS</a> /
<a href=https://koobai.com/index.xml target=_blank>博文 RSS</a></div></div></div></div></div><script src="/js/moment.min.js?v=2.29.4"></script><script src=/js/moment.twitter.min.js></script><script>function formatDate(e){return typeof e=="number"&&(e=new Date(e*1e3).toISOString()),moment(Date.parse(e)).twitterLong().replace(/\s\d{2}:\d{2}/,"")}</script><div class=single-nrong><div class=single-zw><div class=article_details><div class=article_details_title>Github自动构建Hugo, 并同步到腾讯COS, 同时刷新CDN缓存</div><img src=https://img.koobai.com/article/cdn.svg class="top-img img-hide"></div><div class=content_zhengwen><div class=content><p>博客逐步搭建完善，更新了日常使用的
<a href=https://koobai.com/apps/ target=_blank>App</a>、
<a href=https://koobai.com/hardware/ target=_blank>硬件</a>页面。博客样式标题采用了"
<a href="/tiaozhuan?target=aHR0cHM6Ly9naXRodWIuY29tL2F0ZWxpZXItYW5jaG9yL3NtaWxleS1zYW5z" target=_blank>得意黑</a>&ldquo;开源字体。把二级域名改成一级，过程中发现 Cloudflare Pages 如果要绑定一级，须把域名的 DNS 服务器解析过去。解析之后，自己的 nas 访问变得不稳定，时不时的打不开，来来回回折腾了好几次，无解，只好改回去。 vercel 可以绑定一级，尝试之后，访问速度太慢，放弃。开始了解国内的云服务，学习到了对象储存、CDN，经过一番对比尝试，最终选择腾讯云的 COS 对象存储配合内容分发网络 CDN 搭建(主要它的 cosbrowser 界面是经过设计的 ᵔ◡ᵔ；客服也很负责，咨询问题会电话打过来详细教你如何操作)。</p><p>在了解部署过程中发现 Cyrus&rsquo;s Blog 写的&rdquo;
<a href="/tiaozhuan?target=aHR0cHM6Ly9ibG9nLnhtLm1rL3Bvc3RzL2ZjODM%3d" target=_blank>自动构建 Hugo 博客部署至腾讯云对象存储 COS 并刷新 CDN</a>&ldquo;教程，一番折腾，完美。感谢作者。<br>备份记录下过程: (详细的注释可查看 Cyrus&rsquo;s Blog)</p><h3 id=准备工作>准备工作：</h3><ol><li>到腾讯云访问管理——访问密钥——API 密钥管理中，新建一个账户：访问方式改为"编程访问&rdquo;，用户权限添加"QcloudCOSDataFullControl、 QcloudCDNFullAccess"。完成之后将生成的 SecretId、SecretKey 复制保存。</li><li>到 Github 新建一个仓库(私有公共都行)，把自己 hugo 生成的站点源文件(不是 public 下文件)同步过去。</li><li>在刚创建的仓库——Settings——Secrets and variables——Actions，新建 SecretId、SecretKey、Bucket、 Region 四个密钥。其中 SecretId、SecretKey 为上面复制保存的，Bucket(存储桶名称)、 Region(所属地域 )在 COS 中存储桶列表中获取。</li></ol><h3 id=部署>部署:</h3><ol><li>在 Github 仓库根目录，新建".github/workflows"文件夹，并新建 xxx.yml 文件，复制以下代码到文件里。作用：借助 Github Action 实现自动部署。</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build and deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c># 自动触发构建</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c># 构建hugo及生产静态页面</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Hugo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-hugo@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>hugo-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;latest&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>extended</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>hugo --minify</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c># 上传到腾讯COS存储桶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Python</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-python@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>python-version</span><span class=p>:</span><span class=w> </span><span class=m>3.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup coscmd and sdk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>sudo pip install coscmd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Configure coscmd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SECRET_ID</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SecretId }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SECRET_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SecretKey }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>BUCKET</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.Bucket }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>REGION</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.Region }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>coscmd config -a $SECRET_ID -s $SECRET_KEY -b $BUCKET -r $REGION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Upload to COS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>coscmd upload -rfs --delete public/ /</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c># 刷新腾讯CDN缓存目录</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Flush CDN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SECRET_ID</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SecretId }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SECRET_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SecretKey }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          pip install --upgrade tencentcloud-sdk-python
</span></span></span><span class=line><span class=cl><span class=sd>          python flush-dns.py -i $SECRET_ID -k $SECRET_KEY</span><span class=w>
</span></span></span></code></pre></div><ol start=2><li>在 Github 仓库根目录，新建 flush-dns.py 文件，复制以下代码到文件里，并将里面的"koobai.com"域名修改成自己的 CDN 加速域名。作用：通过 Python 脚本实现刷新 CDN 缓存，详细参数可参考
<a href="/tiaozhuan?target=aHR0cHM6Ly9jb25zb2xlLmNsb3VkLnRlbmNlbnQuY29tL2FwaS9leHBsb3Jlcj9Qcm9kdWN0PWNkbiZWZXJzaW9uPTIwMTgtMDYtMDYmQWN0aW9uPVB1cmdlUGF0aENhY2hl" target=_blank>腾讯的调用 aip 文档</a>。</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>argparse</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tencentcloud.common</span> <span class=kn>import</span> <span class=n>credential</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tencentcloud.common.profile.client_profile</span> <span class=kn>import</span> <span class=n>ClientProfile</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tencentcloud.common.profile.http_profile</span> <span class=kn>import</span> <span class=n>HttpProfile</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tencentcloud.common.exception.tencent_cloud_sdk_exception</span> <span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>TencentCloudSDKException</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tencentcloud.cdn.v20180606</span> <span class=kn>import</span> <span class=n>cdn_client</span><span class=p>,</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 传入参数</span>
</span></span><span class=line><span class=cl><span class=n>parser</span> <span class=o>=</span> <span class=n>argparse</span><span class=o>.</span><span class=n>ArgumentParser</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=s1>&#39;-i &lt;secretId&gt; -k &lt;secretKey&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;-i&#39;</span><span class=p>,</span> <span class=s1>&#39;--secretid&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;secretId&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;-k&#39;</span><span class=p>,</span> <span class=s1>&#39;--secretkey&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;secretKey&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>args</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>cred</span> <span class=o>=</span> <span class=n>credential</span><span class=o>.</span><span class=n>Credential</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>secretid</span><span class=p>,</span><span class=n>args</span><span class=o>.</span><span class=n>secretkey</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>httpProfile</span> <span class=o>=</span> <span class=n>HttpProfile</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>httpProfile</span><span class=o>.</span><span class=n>endpoint</span> <span class=o>=</span> <span class=s2>&#34;cdn.tencentcloudapi.com&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>clientProfile</span> <span class=o>=</span> <span class=n>ClientProfile</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>clientProfile</span><span class=o>.</span><span class=n>httpProfile</span> <span class=o>=</span> <span class=n>httpProfile</span>
</span></span><span class=line><span class=cl>    <span class=n>client</span> <span class=o>=</span> <span class=n>cdn_client</span><span class=o>.</span><span class=n>CdnClient</span><span class=p>(</span><span class=n>cred</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=n>clientProfile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>req</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>PurgePathCacheRequest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;Paths&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;https://koobai.com/&#34;</span><span class=p>,</span> <span class=s2>&#34;https://www.koobai.com/&#34;</span><span class=p>],</span> <span class=s2>&#34;FlushType&#34;</span><span class=p>:</span> <span class=s2>&#34;flush&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>req</span><span class=o>.</span><span class=n>from_json_string</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>params</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>resp</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>PurgePathCache</span><span class=p>(</span><span class=n>req</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>to_json_string</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=n>TencentCloudSDKException</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>err</span><span class=p>)</span>
</span></span></code></pre></div><p>自此部署完毕，当有新文件上传到 main 分支，就会自动触发（hugo 生成静态文件——上传到 COS——刷新 CDN 缓存）。</p><h3 id=查看是否部署成功>查看是否部署成功：</h3><ol><li>Github 仓库 Actions 下，查看构建记录</li><li>COS 存储桶下的文件变动</li><li>CDN 刷新预热下，操作记录——目录刷新</li></ol><h3 id=费用>费用：</h3><p>COS、CDN 费用(包含存储+CDN 回源流量+CDN 流量+HTTPS 请求等)，个人站没什么流量，应该很低，跑一段时间看看。另外腾讯云也提供了六个月一部分免费试用~~</p><h3 id=扩展>扩展：</h3><p>因为博客源文件在 Github 里，可以利用 vercel 平台读取仓库也自动构建一个。如果使用的是阿里云域名 DNS 服务器，可以在解析请求来源选择"境外"，&ldquo;记录值"填写 vercel 平台绑定域名时所提供的。</p><p>这样国内网络访问的时候走腾讯 CDN，国外访问的时候走 vercel 平台所提供的节点。</p></div><div class=single-biaoq><div class=page-time>更新于
<script>document.write(formatDate(1673740800))</script></div><div class=single-tag><div class=single-tag-c>#<a href=/tags/%E5%8D%9A%E5%AE%A2/>博客</a></div><div class=single-tag-c>#<a href=/tags/%E6%8A%98%E8%85%BE/>折腾</a></div><div class=single-tag-c>#<a href=/tags/hugo/>Hugo</a></div></div></div></div><div class=archives_nrong><div class=archives_one><div><div class=archive-title><a href=/time/>十年弹指一挥间</a></div><div class=archive-time><script>document.write(formatDate(1673049600))</script></div></div><div class=archive-img><a href=/time/><img loading=lazy decoding=async src=https://img.koobai.com/article/noy.webp></a></div></div><div class=archives_one><div><div class=archive-title><a href=/hugo_dark/>Hugo主题添加暗黑(夜间)模式, 并自动切换</a></div><div class=archive-time><script>document.write(formatDate(1674086400))</script></div></div><div class=archive-img><a href=/hugo_dark/><img loading=lazy decoding=async src=https://img.koobai.com/article/dark.svg></a></div></div><div href=javascript:void(0) onclick='const r=document.referrer;r&&r.includes(window.location.host)?history.back():window.location.href="/"' class=fanhui title=哪来回哪去 data-umami-event=Fanhui><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M2.614 5.426A1.5 1.5.0 014 4.5h10a7.5 7.5.0 110 15H5a1.5 1.5.0 010-3h9a4.5 4.5.0 100-9H7.621l.94.94a1.5 1.5.0 01-2.122 2.12l-3.5-3.5a1.5 1.5.0 01-.325-1.634z" fill="currentColor"/></svg></div></div><div id=MoreComments onclick=loadComments()>评论一下 ...</div><div class=article-comments id=articlecomments style=display:none><link href=https://img.koobai.com/Artalk.css rel=stylesheet><script src=https://img.koobai.com/Artalk.js></script><div id=Comments></div><script>Artalk.init({el:"#Comments",pageKey:"https://koobai.com/hugo_action_tencentcos/",pageTitle:"Github自动构建Hugo, 并同步到腾讯COS, 同时刷新CDN缓存",server:"https://c.koobai.com",site:"Koobai 空白生活"})</script></div></div><div><div class=paragraph-dh><nav id=TableOfContents><ul><li><ul><li><a href=#准备工作>准备工作：</a></li><li><a href=#部署>部署:</a></li><li><a href=#查看是否部署成功>查看是否部署成功：</a></li><li><a href=#费用>费用：</a></li><li><a href=#扩展>扩展：</a></li></ul></li></ul></nav></div></div></div><script src=/js/single.js></script></div><div class=footer-background><div class=footer><div class=footer-info>&copy; 2026 <a href=/>空白Koobai</a>.
由 <a href=https://gohugo.io/ target=_blank>Hugo </a>提供强力驱动,<span class=youpaiyun><a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target=_blank>又拍云</a>提供图片存储/加速</span>.
<a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备16011784号-1</a> <a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011302000343">浙公网安备 33011302000343 号</a></div></div></div><script src=/js/view-image.min.js></script><script defer src=https://u.koobai.com/mwyaie data-website-id=b1219610-e6ba-4bfd-87aa-5dc38ec49911 data-domains=koobai.com></script><div class=gotop_hide><div class=gotop onclick=smoothScrollTop() id=gotop><svg viewBox="0 0 2048 2048"><path d="m1875 1037-787-787v1798H960V250l-787 787-90-90L1024 6l941 941z"/></svg></div></div><script type=text/javascript src=/js/bundle.min.96f27c33bd4b6dfc9f44e48464c641ba94c313557342bec737596c6da2f14356.js></script></body></html>