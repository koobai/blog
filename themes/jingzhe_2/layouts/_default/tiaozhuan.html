{{ define "body_classes" }}page-tiaozhuan{{ end }}
{{ define "main" }}
<div class="tiaozhuan-all">
  <div class="tiaozhuan-nrong">
    <div class="tiaozhuan-title">å³å°†ç¦»å¼€ {{ .Site.Title }}ï¼Œè·³è½¬åˆ°ä»¥ä¸‹å¤–éƒ¨é“¾æ¥</div>
    <div id="tiaozhuan-link"></div> 
    <div class="tiaozhuan-info">è¯·è‡ªè¡Œè¯†åˆ«è¯¥é“¾æ¥æ˜¯å¦å®‰å…¨ï¼Œå¹¶ä¿ç®¡å¥½ä¸ªäººä¿¡æ¯ã€‚</div>
      <div class="tiaozhuan-button"><a href='' id='direct-link'>ç»§ç»­è®¿é—®</a></div>
  </div>
</div>
<script>
  const params = new URLSearchParams(window.location.search);
  const encodedTarget = params.get('target');

  if (encodedTarget) {
    try {
        // ğŸ›‘ å…³é”®ä¿®æ”¹ï¼šå…ˆ atob è§£ Base64ï¼Œå† decodeURIComponent è§£ä¸­æ–‡ç¼–ç 
        // è¿™ä¸ single.js ä¸­çš„ btoa(encodeURIComponent(...)) æ˜¯æˆå¯¹çš„
        const target = decodeURIComponent(atob(encodedTarget));
        
        // èµ‹å€¼é“¾æ¥å’Œæ–‡æœ¬
        document.getElementById('direct-link').href = target;
        // ä½¿ç”¨ textContent é˜²æ­¢ XSS æ”»å‡»ï¼ˆåªæ˜¾ç¤ºæ–‡æœ¬ï¼Œä¸æ¸²æŸ“ HTMLï¼‰
        document.getElementById('tiaozhuan-link').textContent = target; 
    } catch (e) {
        console.error('é“¾æ¥è§£æå¤±è´¥:', e);
        document.getElementById('tiaozhuan-link').textContent = "æ— æ•ˆçš„é“¾æ¥å‚æ•°";
        document.querySelector('.tiaozhuan-button').style.display = 'none'; // éšè—æŒ‰é’®
    }
  } else {
    document.getElementById('tiaozhuan-link').textContent = "æœªæŒ‡å®šç›®æ ‡åœ°å€";
    document.querySelector('.tiaozhuan-button').style.display = 'none';
  }
</script>
{{ end }}