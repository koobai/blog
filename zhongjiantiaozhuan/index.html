<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>HUGO 外链跳转到中间页 - 空白Koobai</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><link rel=manifest href=/suju/ios.json><link rel=icon href=https://img.koobai.com/koobai.png><link href=/index.xml title=空白Koobai type=application/rss+xml><link rel=canonical href=https://koobai.com/zhongjiantiaozhuan/><link rel=stylesheet href=/css/style.min.e2095f5afb227a152ce89209044a1cf360a2e68cb8e10988f7a09dda1f3f0316.css><meta name=description content='前天在老麦博客中看到"给Twikoo添加链接跳转中间页"博文，因为外部链接你无法确定未来某一天可能就会变成不安全链接，从而影响到自己博客。同时又见到大大的小蜗牛也是因为安全的原因，把博客评论换成了GitHub Discussions。网上也有不少的案例，因为某个链接的原因，而被请喝茶或电话让自己排查。'><meta property="og:title" content="HUGO 外链跳转到中间页"><meta property="og:type" content="website"><meta property="og:url" content="https://koobai.com/zhongjiantiaozhuan/"><meta property="og:image" content="https://img.koobai.com/article/20240202_tiaozhuan1.webp"><meta property="og:description" content='前天在老麦博客中看到"给Twikoo添加链接跳转中间页"博文，因为外部链接你无法确定未来某一天可能就会变成不安全链接，从而影响到自己博客。同时又见到大大的小蜗牛也是因为安全的原因，把博客评论换成了GitHub Discussions。网上也有不少的案例，因为某个链接的原因，而被请喝茶或电话让自己排查。'></head><body class='page page-blog-single'><div id=menu-main-mobile class=menu-main-mobile><ul class=menu><li><a href=https://koobai.com/>唠叨</a></li><li><a href=https://koobai.com/posts/>博文</a></li><li><a href=https://koobai.com/movies/>观影</a></li><li><a href=https://koobai.com/apps/>软件</a></li><li><a href=https://sport.koobai.com/>骑行</a></li><li><a href=https://qiszy.taobao.com>好物</a></li></ul></div><div id=wrapper class=wrapper><div class=header><div id=toggle-menu-main-mobile class=hamburger-trigger><button class=hamburger>Menu</button></div><div class=new-heard-menu><div class=header-menu><a href=/><span class=menu-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bird"><path d="M16 7h.01"/><path d="M3.4 18H12a8 8 0 008-8V7a4 4 0 00-7.28-2.3L2 20"/><path d="m20 7 2 .5-2 .5"/><path d="M10 18v3"/><path d="M14 17.75V21"/><path d="M7 18a6 6 0 003.84-10.61"/></svg>
</span><span class=menu-name>唠叨</span></a></div><div class=header-menu><a href=/posts/><span class=menu-icon><svg width="20" height="20" viewBox="0 0 26 26"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32 1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></svg>
</span><span class=menu-name>博文</span></a></div><div class=header-menu><a href=/movies/><span class=menu-icon><svg width="20" height="20" viewBox="0 -1 27 27"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M18 8a2 2 0 000-4 2 2 0 00-4 0 2 2 0 00-4 0A2 2 0 006 4a2 2 0 000 4m4 14L9 8m5 14 1-14"/><path d="M20 8c.5.0.9.4.8 1l-2.6 12c-.1.5-.7 1-1.2 1H7c-.6.0-1.1-.4-1.2-1L3.2 9c-.1-.6.3-1 .8-1z"/></g></svg>
</span><span class=menu-name>观影</span></a></div><div class=header-menu><a href=/apps/><span class=menu-icon><svg width="20" height="20" viewBox="30 38 206 206"><g fill="none"><path fill="#00A0E2" fill-rule="evenodd" d="M191.072 195.009c-3.27 5.387-6.54 9.426-10.484 13.176-4.424 3.944-5.674 7.406-15.87 8.754-7.213 1.347-13.465-1.348-15.87-2.405-7.214-3.367-10.966-4.424-15.293-4.424-4.232.0-7.791 1.058-14.909 4.328-2.212 1.153-8.175 3.751-15.485 2.405-7.502-1.347-11.35-4.232-14.139-6.637-5.771-5.097-10.1-9.907-14.043-15.485z" clip-rule="evenodd"/><path fill="#34BE2D" fill-rule="evenodd" d="M58.726 105.27c3.366-7.598 7.79-12.696 12.215-16.255 11.253-9.233 29.624-9.81 38.088-7.598 6.926 1.731 11.831 5.963 19.622 5.963 8.175.0 12.887-4.136 19.333-5.963 8.464-2.116 26.931-1.443 38.954 7.79 3.559 2.694 6.827 6.349 8.655 8.369-4.327 3.174-6.925 5.482-9.041 7.694z" clip-rule="evenodd"/><path fill="#FFB400" fill-rule="evenodd" d="M186.553 105.27c-2.02 2.212-3.462 4.329-5.098 7.31-1.922 3.463-4.232 8.176-4.809 15.293H53.051c.096-1.154.192-2.404.384-3.655 1.155-7.598 2.982-13.85 5.29-18.948z" clip-rule="evenodd"/><path fill="#FF7A00" fill-rule="evenodd" d="M176.646 127.873a74 74 0 000 6.541c.289 5.29 2.116 11.157 4.521 15.87l-125.712-.289c-1.731-7.598-2.693-15.389-2.404-22.122z" clip-rule="evenodd"/><path fill="#F41E34" fill-rule="evenodd" d="M181.166 150.284a33 33 0 003.558 5.771c8.272 10.58 11.831 10.58 18.275 13.851-.479 1.152-.864 2.212-1.346 3.174l-138.888-.289c-2.693-5.867-5.482-14.139-7.31-22.795z" clip-rule="evenodd"/><path fill="#A2359C" fill-rule="evenodd" d="M201.653 173.08c-4.039 9.426-7.31 16.349-10.581 21.929l-116.091-.288c-3.848-5.675-7.31-11.928-11.254-19.719-.288-.673-.673-1.443-.962-2.211z" clip-rule="evenodd"/><path fill="#34BE2D" fill-rule="evenodd" d="M161.352 52.658c-.674 4.81-3.078 10.965-6.925 14.908-4.138 4.425-10.581 9.234-14.429 11.639-2.116 1.346-7.599 1.538-12.118 2.02-.577-4.04-.673-7.503.577-11.254 1.635-4.424 3.753-10.772 7.118-15.197 4.135-5.482 8.848-9.233 11.445-10.58 3.464-1.731 9.235-4.328 14.236-5.194.193 4.424.867 9.426.096 13.658" clip-rule="evenodd"/></g></svg>
</span><span class=menu-name>软件</span></a></div><div class=header-menu><a href=https://sport.koobai.com/><span class=menu-icon><svg width="20" height="20" viewBox="0 -1 26 26"><path fill="currentColor" d="M5.5 21a4.5 4.5.0 110-9 4.5 4.5.0 010 9m0-2a2.5 2.5.0 100-5 2.5 2.5.0 000 5m13 2a4.5 4.5.0 110-9 4.5 4.5.0 010 9m0-2a2.5 2.5.0 100-5 2.5 2.5.0 000 5m-7.477-8.695L13 12v6h-2v-5l-2.719-2.266A2 2 0 018 7.671l2.828-2.828a2 2 0 012.829.0l1.414 1.414a6.97 6.97.0 003.917 1.975l-.01 2.015a8.96 8.96.0 01-5.321-2.575zM16 5a2 2 0 110-4 2 2 0 010 4"/></svg>
</span><span class=menu-name>骑行</span></a></div><div class=header-menu><a href=https://qiszy.taobao.com target=_blank><span class=menu-icon><svg width="20" height="20" viewBox="0 0 26 26"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 2v2m4-2v2m2 4a1 1 0 011 1v8a4 4 0 01-4 4H7a4 4 0 01-4-4V9a1 1 0 011-1h14a4 4 0 110 8h-1M6 2v2"/></svg>
</span><span class=menu-name>好物</span></a></div></div><div class=index-laodao><div class=index-laodao-titile></div></div><div class=heard-right><div class="about-koobai avatar-mobile"><a href=/about><img src=https://img.koobai.com/koobai.webp alt=koobai title=我 data-umami-event=me></a></div><a href=https://github.com/koobai/blog title=Github target=_blank class=githuab><svg aria-hidden="true" viewBox="0 0 16 16" data-view-component="true"><path d="M8 0c4.42.0 8 3.58 8 8a8.013 8.013.0 01-5.45 7.59c-.4.08-.55-.17-.55-.38.0-.27.01-1.13.01-2.2.0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95.0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12.0.0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27s-1.36.09-2 .27c-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15.0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94.0.67.01 1.3.01 1.49.0.21-.15.45-.55.38A7.995 7.995.0 010 8c0-4.42 3.58-8 8-8z"/></svg></a>
<a href=https://space.bilibili.com/2084095738 target=_blank title=当UP主的一天><svg width="20" height="20" viewBox="0 0 18 18" fill="none" class="zhuzhan-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.73252 2.67094c-.40023-.3861-.40023-1.02721.0-1.4133.38039-.366956.983-.366956 1.36339.0L7.21723 3.30403C7.27749 3.36218 7.32869 3.4261 7.37081 3.49407H10.5789C10.6211 3.4261 10.6723 3.36218 10.7325 3.30403l2.1213-2.04639C13.2342.890684 13.8368.890684 14.2172 1.25764c.4003.38609.4003 1.0272.0 1.4133L13.364 3.49407H14c2.2091.0 4 1.79086 4 4V12.9996c0 2.2091-1.7909 4-4 4H4c-2.20914.0-4-1.7909-4-4V7.49406C0 5.28492 1.79086 3.49407 4 3.49407h.58579l-.85327-.82313zM4 5.42343c-1.10457.0-2 .89543-2 2V13.0702c0 1.1046.89543 2 2 2H14c1.1046.0 2-.8954 2-2V7.42343c0-1.10457-.8954-2-2-2H4zM5 9.31747c0-.55228.44772-1 1-1s1 .44772 1 1V10.2115c0 .552300000000001-.44772 1-1 1S5 10.7638 5 10.2115V9.31747zm7-1c-.552300000000001.0-1 .44772-1 1V10.2115C11 10.7638 11.4477 11.2115 12 11.2115S13 10.7638 13 10.2115V9.31747c0-.55228-.447699999999999-1-1-1z"/></svg></a></div></div><script src="/js/moment.min.js?v=2.29.4"></script><script src=/js/moment.twitter.min.js></script><script>function formatDate(e){return typeof e=="number"&&(e=new Date(e*1e3).toISOString()),moment(Date.parse(e)).twitterLong().replace(/\s\d{2}:\d{2}/,"")}</script><div class=single-nrong><div class=single-zw><div class=article_details><div class=article_details_title>HUGO 外链跳转到中间页</div><img src=https://img.koobai.com/article/20240202_tiaozhuan1.webp class="top-img img-hide"></div><div class=content_zhengwen><div class=content><p>前天在老麦博客中看到"
<a href="/tiaozhuan?target=aHR0cHM6Ly93d3cuaWFtbG0uY29tLw%3d%3d" target=_blank>给Twikoo添加链接跳转中间页</a>&ldquo;博文，因为外部链接你无法确定未来某一天可能就会变成不安全链接，从而影响到自己博客。同时又见到
<a href="/tiaozhuan?target=aHR0cHM6Ly93d3cuZWFsbGlvbi5jb20v" target=_blank>大大的小蜗牛</a>也是因为安全的原因，把博客评论换成了GitHub Discussions。网上也有不少的案例，因为某个链接的原因，而被请喝茶或电话让自己排查。今天在
<a href="/tiaozhuan?target=aHR0cHM6Ly9sbXMucHViLw%3d%3d" target=_blank>不亦乐乎</a>那见链接也是跳转到中间页，于是请教了下怎么实现的，感谢。之后经过与 AI 的博弈，搞定。这次使用 ChatGPT 跟 Claude 都不行，说了一堆，完全不懂，最后使用 coze 搞定基本框架，然后再来回沟通逐步完善功能。估计跟它使用的 ChatGPT 4.0 接口有关。想充值 ChatGPT，奈何月费太贵了。</p><p>新建 js 文件，如：tiaozhuan.js。里面的网址为排除跳转中间页。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>checkParent</span><span class=p>(</span><span class=nx>element</span><span class=p>,</span> <span class=nx>classNames</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=nx>element</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>element</span><span class=p>.</span><span class=nx>classList</span> <span class=o>&amp;&amp;</span> <span class=nx>classNames</span><span class=p>.</span><span class=nx>some</span><span class=p>(</span><span class=nx>cn</span> <span class=p>=&gt;</span> <span class=nx>element</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>contains</span><span class=p>(</span><span class=nx>cn</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>element</span> <span class=o>=</span> <span class=nx>element</span><span class=p>.</span><span class=nx>parentElement</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>excludedClasses</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;talks_comments&#39;</span><span class=p>,</span><span class=s1>&#39;tiaozhuan-button&#39;</span><span class=p>];</span> <span class=c1>// 添加需要排除的a标签类名class
</span></span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;load&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>target</span> <span class=o>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=nx>target</span> <span class=o>&amp;&amp;</span> <span class=nx>target</span><span class=p>.</span><span class=nx>nodeName</span> <span class=o>!==</span> <span class=s1>&#39;A&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>target</span> <span class=o>=</span> <span class=nx>target</span><span class=p>.</span><span class=nx>parentNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>target</span> <span class=o>&amp;&amp;</span> <span class=nx>target</span><span class=p>.</span><span class=nx>nodeName</span> <span class=o>===</span> <span class=s1>&#39;A&#39;</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl><span class=o>!</span><span class=nx>checkParent</span><span class=p>(</span><span class=nx>target</span><span class=p>,</span> <span class=nx>excludedClasses</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl><span class=o>!</span><span class=nx>target</span><span class=p>.</span><span class=nx>href</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;koobai.com&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl><span class=o>!</span><span class=nx>target</span><span class=p>.</span><span class=nx>href</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;douban.com&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl><span class=o>!</span><span class=nx>target</span><span class=p>.</span><span class=nx>href</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;bilibili.com&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl><span class=o>!</span><span class=nx>target</span><span class=p>.</span><span class=nx>href</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;github.com&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl><span class=nx>target</span><span class=p>.</span><span class=nx>hostname</span> <span class=o>!==</span> <span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>hostname</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>encodedUrl</span> <span class=o>=</span> <span class=nx>btoa</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>href</span><span class=p>);</span> <span class=c1>// Base64 encode the URL
</span></span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>url</span> <span class=o>=</span> <span class=s1>&#39;/tiaozhuan?target=&#39;</span> <span class=o>+</span> <span class=nx>encodedUrl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=s1>&#39;_blank&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>在模板_default目录下，新建一个 html，如tiaozhuan.html。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{ define &#34;body_classes&#34; }}page-tiaozhuan{{ end }}
</span></span><span class=line><span class=cl>{{ define &#34;main&#34; }}
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;tiaozhuan-all&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;tiaozhuan-nrong&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;tiaozhuan-title&#34;</span><span class=p>&gt;</span>即将离开 {{ .Site.Title }}，跳转到以下外部链接<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;tiaozhuan-link&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span> 
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;tiaozhuan-info&#34;</span><span class=p>&gt;</span>请自行识别该链接是否安全，并保管好个人信息。<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;tiaozhuan-button&#34;</span><span class=p>&gt;&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#39;&#39;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#39;direct-link&#39;</span><span class=p>&gt;</span>继续访问<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URLSearchParams</span><span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>search</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>encodedTarget</span> <span class=o>=</span> <span class=nx>params</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;target&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>target</span> <span class=o>=</span> <span class=nx>atob</span><span class=p>(</span><span class=nx>encodedTarget</span><span class=p>);</span> <span class=c1>// 使用 atob 进行 Base64 解码
</span></span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>target</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;direct-link&#39;</span><span class=p>).</span><span class=nx>href</span> <span class=o>=</span> <span class=nx>target</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;tiaozhuan-link&#39;</span><span class=p>).</span><span class=nx>textContent</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span> <span class=o>+</span> <span class=nx>target</span><span class=p>;</span> <span class=c1>// 直接显示目标地址    
</span></span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;未指定重定向目标。&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>{{ end }}
</span></span></code></pre></div><p>相关 css，根据主题风格调整。其中 background 为明暗模式下不同的背景图。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>tiaozhuan-all</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>position</span><span class=p>:</span> <span class=kc>relative</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>box-shadow</span><span class=p>:</span> <span class=nb>rgba</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mf>0.25</span><span class=p>)</span> <span class=mi>0</span><span class=kt>px</span> <span class=mi>25</span><span class=kt>px</span> <span class=mi>50</span><span class=kt>px</span> <span class=mi>-12</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>border-radius</span><span class=p>:</span> <span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>background</span><span class=p>:</span> <span class=mh>#fff</span> <span class=nb>url</span><span class=p>(</span><span class=sx>/tiaozhuanico.webp</span><span class=p>)</span> <span class=kc>no-repeat</span> <span class=kc>center</span> <span class=kc>center</span> <span class=o>/</span> <span class=kc>cover</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>color</span><span class=p>:</span> <span class=mh>#666</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>word-break</span><span class=p>:</span> <span class=n>break-all</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>max-width</span><span class=p>:</span> <span class=mi>700</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>height</span><span class=p>:</span> <span class=mi>350</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>text-align</span><span class=p>:</span> <span class=kc>center</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>font-size</span><span class=p>:</span> <span class=mf>0.85</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>overflow</span><span class=p>:</span> <span class=kc>hidden</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>margin</span><span class=p>:</span> <span class=mi>100</span><span class=kt>px</span> <span class=kc>auto</span> <span class=mi>0</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>  <span class=err>@include</span> <span class=err>breakpoint(&#39;small&#39;)</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=k>aspect-ratio</span><span class=p>:</span> <span class=mi>2</span> <span class=o>/</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>height</span><span class=p>:</span> <span class=kc>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nc>tiaozhuan-nrong</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>position</span><span class=p>:</span> <span class=kc>absolute</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>bottom</span><span class=p>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>left</span><span class=p>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>right</span><span class=p>:</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>padding</span><span class=p>:</span> <span class=mi>20</span><span class=kt>px</span> <span class=mi>20</span><span class=kt>px</span> <span class=mi>30</span><span class=kt>px</span> <span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nc>tiaozhuan-title</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>font-size</span><span class=p>:</span> <span class=mf>1.3</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>font-family</span><span class=p>:</span> <span class=nf>var</span><span class=p>(</span><span class=o>--</span><span class=n>font</span><span class=o>-</span><span class=n>family</span><span class=o>-</span><span class=n>title</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>color</span><span class=p>:</span> <span class=mh>#222</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>line-height</span><span class=p>:</span> <span class=mf>1.4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>margin-bottom</span><span class=p>:</span> <span class=mi>4</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nc>tiaozhuan-info</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>margin-top</span><span class=p>:</span> <span class=mi>6</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nc>tiaozhuan-button</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>margin-top</span><span class=p>:</span> <span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nc>tiaozhuan-button</span> <span class=nt>a</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>color</span><span class=p>:</span> <span class=nf>var</span><span class=p>(</span><span class=o>--</span><span class=kc>text</span><span class=o>-</span><span class=n>highlight</span><span class=o>-</span><span class=kc>color</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>border-radius</span><span class=p>:</span> <span class=mi>4</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>padding</span><span class=p>:</span> <span class=mi>10</span><span class=kt>px</span> <span class=mi>30</span><span class=kt>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>font-family</span><span class=p>:</span> <span class=nf>var</span><span class=p>(</span><span class=o>--</span><span class=n>font</span><span class=o>-</span><span class=n>family</span><span class=o>-</span><span class=n>title</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>font-size</span><span class=p>:</span> <span class=mf>0.85</span><span class=kt>rem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>border</span><span class=p>:</span> <span class=mf>0.5</span><span class=kt>px</span> <span class=kc>solid</span> <span class=nf>var</span><span class=p>(</span><span class=o>--</span><span class=kc>text</span><span class=o>-</span><span class=n>highlight</span><span class=o>-</span><span class=kc>color</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>display</span><span class=p>:</span> <span class=kc>inline-block</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>media</span> <span class=o>(</span><span class=nt>prefers-color-scheme</span><span class=o>:</span> <span class=nt>dark</span><span class=o>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nc>tiaozhuan-all</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>background</span><span class=p>:</span> <span class=nf>var</span><span class=p>(</span><span class=o>--</span><span class=n>background</span><span class=o>-</span><span class=n>dark</span><span class=o>-</span><span class=kc>color</span><span class=p>)</span> <span class=nb>url</span><span class=p>(</span><span class=sx>/tiaozhuandark.webp</span><span class=p>)</span> <span class=kc>no-repeat</span> <span class=kc>center</span> <span class=kc>center</span> <span class=o>/</span> <span class=kc>cover</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>color</span><span class=p>:</span> <span class=mh>#acacac</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nc>tiaozhuan-title</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>color</span><span class=p>:</span> <span class=mh>#ddd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>最后在页尾引用js文件即可，如</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;/js/tiaozhuan.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>搞定，整体思路是：js文件识别链接的a标签，并把链接用 base64 编码，同时排除一些不需要跳转中间页的class或网站。然后跳转到tiaozhuan.html文件中（链接格式为/tiaozhuan?target=base64编码），html文件承担了中间页具体信息，及跳转动作。如使用base64解码跳转的链接。</p><p>以上为全局引用JS方法，判断 a 标签。下面利用 Hugo 内置的 render-link.html 实现。在模板_default/_makup目录下新建 render-link.html文件。思路是直接给链接添加 &ldquo;/tiaozhuan?target=base64编码&rdquo;。下面代码中的 &ldquo;/&rdquo; 为排除内链；网址为排除特定地址。感谢
<a href="/tiaozhuan?target=aHR0cHM6Ly93d3cuZWFsbGlvbi5jb20v" target=_blank>大大的小蜗牛</a>提示的 render-link 方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>{{ $url := .Destination }}
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> 
</span></span><span class=line><span class=cl>    <span class=err>{{</span> <span class=na>if</span> <span class=na>or</span> <span class=err>(</span><span class=na>in</span> <span class=err>$</span><span class=na>url</span> <span class=err>&#34;</span><span class=na>koobai</span><span class=err>.</span><span class=na>com</span><span class=err>&#34;)</span> <span class=err>(</span><span class=na>strings</span><span class=err>.</span><span class=na>HasPrefix</span> <span class=err>$</span><span class=na>url</span> <span class=err>&#34;/&#34;)</span> <span class=err>}}</span>
</span></span><span class=line><span class=cl>        <span class=na>href</span><span class=o>=</span><span class=s>&#34;{{ $url }}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=err>{{</span> <span class=na>else</span> <span class=err>}}</span>
</span></span><span class=line><span class=cl>        <span class=na>href</span><span class=o>=</span><span class=s>&#34;/tiaozhuan?target={{ $url | base64Encode }}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=err>{{</span> <span class=na>end</span> <span class=err>}}</span>
</span></span><span class=line><span class=cl>    <span class=err>{{</span> <span class=na>if</span> <span class=na>strings</span><span class=err>.</span><span class=na>HasPrefix</span> <span class=err>.</span><span class=na>Destination</span> <span class=err>&#34;</span><span class=na>http</span><span class=err>&#34;</span> <span class=err>}}</span> <span class=na>target</span><span class=o>=</span><span class=s>&#34;_blank&#34;</span><span class=err>{{</span> <span class=na>end</span> <span class=err>}}</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>{{ .Text | safeHTML }}<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>针对无法给链接添加 &ldquo;/tiaozhuan?target=base64编码&rdquo; 的，譬如 Artalk 评论，可以特定使用 js 判断。里面的.atk-comment-wrap a 就是 Artalk 评论的 a 标签；网址为排除特定地址。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>target</span> <span class=o>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>closest</span><span class=p>(</span><span class=s1>&#39;.atk-comment-wrap a, .datacont a&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>target</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>target</span><span class=p>.</span><span class=nx>href</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;koobai.com&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>encodedUrl</span> <span class=o>=</span> <span class=nx>btoa</span><span class=p>(</span><span class=nx>target</span><span class=p>.</span><span class=nx>href</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>url</span> <span class=o>=</span> <span class=s1>&#39;/tiaozhuan?target=&#39;</span> <span class=o>+</span> <span class=nx>encodedUrl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nb>window</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=s1>&#39;_blank&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>对于浏览体验来说，多了一步跳转，总归是不好，但为了愉快的玩耍博客，稳妥一点更佳。现在把各个页面的评论都去掉了，只留下了唠叨跟博文评论，并且把博文的评论默认设为隐藏。倒也不是因为所谓的安全，主要是觉得评论的样式有待提高。</p><p>如果觉得跳转中间页很烦人，浏览器可以装个
<a href="/tiaozhuan?target=aHR0cHM6Ly9jaHJvbWV3ZWJzdG9yZS5nb29nbGUuY29tL2RldGFpbC9za2lwLXJlZGlyZWN0L2phb2FmamRvaWpkY29uZW1kbW9kaGJmcGlhbmVobG9u" target=_blank>Skip Redirect</a>插件，告别所有网站的中间页跳转，直接抵达目标地址。</p></div><div class=single-biaoq><div class=page-time>更新于
<script>document.write(formatDate(1706797735))</script></div><div class=single-tag><div class=single-tag-c>#<a href=/tags/%E5%8D%9A%E5%AE%A2/>博客</a></div><div class=single-tag-c>#<a href=/tags/%E6%8A%98%E8%85%BE/>折腾</a></div><div class=single-tag-c>#<a href=/tags/hugo/>Hugo</a></div><div class=single-tag-c>#<a href=/tags/ai/>AI</a></div></div></div></div><div class=archives_nrong><div class=archives_one><div><div class=archive-title><a href=/tossblog/>折腾博客更像是自己的精神鸦片</a></div><div class=archive-time><script>document.write(formatDate(1706600449))</script></div></div><div class=archive-img><a href=/tossblog/><img loading=lazy decoding=async src=https://img.koobai.com/article/20240130_tossblog.webp></a></div></div><div class=archives_one><div><div class=archive-title><a href=/chunjie/>这个春节有什么不一样</a></div><div class=archive-time><script>document.write(formatDate(1708158166))</script></div></div><div class=archive-img><a href=/chunjie/><img loading=lazy decoding=async src=https://img.koobai.com/article/20240217_IMG_1443.webp></a></div></div></div><div id=MoreComments onclick=loadComments()>评论一下 ...</div><div class=article-comments id=articlecomments style=display:none><link href=https://img.koobai.com/Artalk.css rel=stylesheet><script src=https://img.koobai.com/Artalk.js></script><div id=Comments></div><script>Artalk.init({el:"#Comments",pageKey:"https://koobai.com/zhongjiantiaozhuan/",pageTitle:"HUGO 外链跳转到中间页",server:"https://c.koobai.com",site:"Koobai 空白生活"})</script></div></div><div><div class=paragraph-dh><nav id=TableOfContents></nav></div></div></div><script src=/js/single.js></script></div><div class=footer-background><div class=footer><div class=footer-info>&copy; 2026 <a href=/>空白Koobai</a>.
由 <a href=https://gohugo.io/ target=_blank>Hugo </a>提供强力驱动,<span class=youpaiyun><a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target=_blank>又拍云</a>提供图片存储/加速</span>.
<a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备16011784号-1</a> <a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011302000343">浙公网安备 33011302000343 号</a></div><div class=footer-rss><a href=https://memos.koobai.com/u/1/rss.xml target=_blank>唠叨 RSS</a> /
<a href=https://koobai.com/index.xml target=_blank>博文 RSS</a></div></div></div><script src=/js/view-image.min.js></script><div class=gotop_hide><div class=gotop onclick=smoothScrollTop() id=gotop><svg viewBox="0 0 2048 2048"><path d="m1875 1037-787-787v1798H960V250l-787 787-90-90L1024 6l941 941z"/></svg></div></div><script type=text/javascript src=/js/bundle.min.96f27c33bd4b6dfc9f44e48464c641ba94c313557342bec737596c6da2f14356.js></script></body></html>